<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EITEC VPN - 模块管理中心</title>
    
    <!-- Bootstrap CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="/static/css/all.min.css" rel="stylesheet">
    <!-- 新的现代化CSS -->
    <link href="/static/css/dashboard-new.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    

</head>
<body>
    <!-- 背景渐变 -->
    <div class="background-gradient"></div>
    
    <!-- 主界面 -->
    <div id="mainDashboard" class="dashboard-container">
        <!-- 顶部导航栏 -->
        <nav class="top-navbar">
            <div class="nav-left">
                <div class="brand">
                    <div class="brand-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="brand-text">
                        <h1>EITEC VPN</h1>
                        <span class="brand-subtitle">模块管理中心</span>
                    </div>
                </div>
            </div>
            
            <div class="nav-center">
                <div class="connection-status">
                    <div class="status-indicator" id="mainStatus">
                        <div class="status-dot"></div>
                        <span id="statusText">连接中...</span>
                    </div>
                    <div class="connection-info">
                        <span id="serverInfo">--</span>
                        <span class="separator">•</span>
                        <span id="uptimeInfo">--</span>
                    </div>
                </div>
            </div>
            
            <div class="nav-right">
                <div class="nav-actions">
                    <button class="nav-btn primary" onclick="refreshDashboard()">
                        <i class="fas fa-sync-alt"></i>
                        <span>刷新</span>
                    </button>
                    <button class="nav-btn" onclick="showQuickActions()">
                        <i class="fas fa-bolt"></i>
                        <span>操作</span>
                    </button>
                    <button class="nav-btn" onclick="showConfigUploadModal()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span>上传配置</span>
                    </button>
                    <button class="nav-btn" onclick="showSettings()">
                        <i class="fas fa-cog"></i>
                        <span>设置</span>
                    </button>
                    <button class="nav-btn danger" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>退出</span>
                    </button>
                </div>
            </div>
        </nav>

        <!-- 主要内容区域 -->
        <main class="main-content">
            <!-- 核心指标卡片 -->
            <section class="metrics-section">
                <div class="metrics-grid">
                    <!-- VPN状态卡片 -->
                    <div class="metric-card primary">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="card-title">VPN状态</div>
                            <div class="card-actions">
                                <select id="interfaceSelect" class="interface-select" onchange="changeInterface()">
                                    <option value="wg0">wg0</option>
                                    <option value="wg1">wg1</option>
                                    <option value="wg2">wg2</option>
                                    <option value="wg3">wg3</option>
                                </select>
                                <button class="action-btn" onclick="restartVPN()" title="重启VPN">
                                    <i class="fas fa-redo"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="main-value" id="vpnStatus">--</div>
                            <div class="sub-value" id="vpnDetail">检查中...</div>
                        </div>
                        <div class="card-footer">
                            <div class="status-item">
                                <span class="label">连接质量</span>
                                <span class="value" id="connectionQuality">--</span>
                            </div>
                            <div class="status-item">
                                <span class="label">延迟</span>
                                <span class="value" id="latency">--</span>
                            </div>
                            <div class="vpn-controls">
                                <button class="control-btn start" onclick="startVPN()" id="startBtn" style="display: none;">
                                    <i class="fas fa-play"></i> 启动
                                </button>
                                <button class="control-btn stop" onclick="stopVPN()" id="stopBtn" style="display: none;">
                                    <i class="fas fa-stop"></i> 停止
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 流量统计卡片 -->
                    <div class="metric-card success">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="card-title">流量统计</div>
                            <div class="card-actions">
                                <button class="action-btn" onclick="resetTraffic()" title="重置统计">
                                    <i class="fas fa-undo"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="traffic-chart">
                                <canvas id="trafficChart" width="200" height="80"></canvas>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="traffic-item">
                                <span class="label">上传</span>
                                <span class="value" id="uploadTraffic">--</span>
                            </div>
                            <div class="traffic-item">
                                <span class="label">下载</span>
                                <span class="value" id="downloadTraffic">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- 网络性能监控卡片 -->
                    <div class="metric-card info">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-tachometer-alt"></i>
                            </div>
                            <div class="card-title">网络性能</div>
                            <div class="card-actions">
                                <button class="action-btn" onclick="refreshNetworkMetrics()" title="刷新">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="network-summary">
                                <div class="network-metric">
                                    <span class="metric-label">延迟</span>
                                    <span class="metric-value" id="networkLatency">--</span>
                                </div>
                                <div class="network-metric">
                                    <span class="metric-label">丢包率</span>
                                    <span class="metric-value" id="packetLoss">--</span>
                                </div>
                                <div class="network-metric">
                                    <span class="metric-label">带宽</span>
                                    <span class="metric-value" id="bandwidth">--</span>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="network-status">
                                <span class="status">质量: <span id="networkQuality">--</span></span>
                                <span class="status">状态: <span id="networkStatus">--</span></span>
                            </div>
                        </div>
                    </div>

                    <!-- 系统资源卡片 -->
                    <div class="metric-card warning">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-server"></i>
                            </div>
                            <div class="card-title">系统资源</div>
                            <div class="card-actions">
                                <button class="action-btn" onclick="showSystemDetails()" title="详细信息">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="resources-grid">
                                <div class="resource-item">
                                    <div class="resource-label">CPU</div>
                                    <div class="resource-chart">
                                        <canvas id="cpuChart" width="60" height="60"></canvas>
                                    </div>
                                    <div class="resource-value" id="cpuUsage">--</div>
                                </div>
                                <div class="resource-item">
                                    <div class="resource-label">内存</div>
                                    <div class="resource-chart">
                                        <canvas id="memoryChart" width="60" height="60"></canvas>
                                    </div>
                                    <div class="resource-value" id="memoryUsage">--</div>
                                </div>
                                <div class="resource-item">
                                    <div class="resource-label">磁盘</div>
                                    <div class="resource-chart">
                                        <canvas id="diskChart" width="60" height="60"></canvas>
                                    </div>
                                    <div class="resource-value" id="diskUsage">--</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 详细监控面板 -->
            <section class="monitoring-section">
                <!-- WireGuard详情面板 -->
                <div class="monitoring-panel" data-panel="wireguard">
                    <div class="panel-header">
                        <div class="panel-title">
                            <i class="fas fa-network-wired"></i>
                            <span>WireGuard 详情</span>
                        </div>
                        <div class="panel-controls">
                            <button class="panel-btn" onclick="refreshWireGuardDetails()">
                                <i class="fas fa-sync-alt"></i>
                                <span>刷新</span>
                            </button>
                            <button class="panel-btn" onclick="viewCurrentConfig()">
                                <i class="fas fa-file-code"></i>
                                <span>查看配置</span>
                            </button>
                            <button class="panel-btn toggle" onclick="togglePanel('wireguard')">
                                <i class="fas fa-chevron-up"></i>
                            </button>
                        </div>
                    </div>
                    <div class="panel-content" id="wireGuardDetails">
                        <!-- WireGuard详细信息 -->
                        <div class="wireguard-details" id="wireGuardInfo">
                            <!-- 接口信息 -->
                            <div class="detail-section">
                                <h4><i class="fas fa-ethernet"></i> 接口详情</h4>
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <span class="label">接口:</span>
                                        <span class="value" id="wgInterface">wg0</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">状态:</span>
                                        <span class="value status-with-dot" id="wgStatus">未激活</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">公钥:</span>
                                        <span class="value" id="wgPublicKey">--</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">局域网 IP 地址:</span>
                                        <span class="value" id="wgLanIP">10.10.0.7/32</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">监听端口:</span>
                                        <span class="value" id="wgListenPort">--</span>
                                    </div>
                                </div>

                            </div>
                            
                            <!-- 节点和连接统计 -->
                            <div class="detail-section">
                                <h4><i class="fas fa-network-wired"></i> 节点和连接统计</h4>
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <span class="label">节点:</span>
                                        <span class="value" id="wgNode">--</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">预共享密钥:</span>
                                        <span class="value" id="wgPresharedKey">--</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">对端:</span>
                                        <span class="value" id="wgEndpoint">--</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">路由的 IP 地址 (段):</span>
                                        <span class="value" id="wgRoutedIPs">--</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">连接保活间隔:</span>
                                        <span class="value" id="wgKeepalive">--</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">接收数据量:</span>
                                        <span class="value" id="wgReceivedData">--</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">发送数据量:</span>
                                        <span class="value" id="wgSentData">--</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">最新的握手:</span>
                                        <span class="value" id="wgLatestHandshake">--</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </section>
        </main>
    </div>

    <!-- 配置文件查看模态框 -->
    <div class="modal-overlay" id="configModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-file-code"></i> WireGuard 配置文件</h3>
                <button class="close-btn" onclick="closeConfigModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="config-content">
                    <div class="config-header">
                        <span class="config-filename">wg0.conf</span>
                        <button class="copy-btn" onclick="copyConfigContent()">
                            <i class="fas fa-copy"></i> 复制
                        </button>
                    </div>
                    <pre class="config-text" id="configContent">正在加载配置文件...</pre>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeConfigModal()">关闭</button>
            </div>
        </div>
    </div>

    <!-- 快速操作菜单 -->
    <div class="quick-actions-overlay" id="quickActionsOverlay">
        <div class="quick-actions-menu">
            <div class="menu-header">
                <h3>快速操作</h3>
                <button class="close-btn" onclick="hideQuickActions()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="menu-content">
                <div class="action-group">
                    <h4>VPN管理</h4>
                    <button class="action-item" onclick="restartVPN()">
                        <i class="fas fa-redo"></i>
                        <span>重启VPN</span>
                    </button>
                    <button class="action-item" onclick="updateConfig()">
                        <i class="fas fa-sync-alt"></i>
                        <span>更新配置</span>
                    </button>
                </div>
                <div class="action-group">
                    <h4>系统管理</h4>
                    <button class="action-item" onclick="showLogs()">
                        <i class="fas fa-file-alt"></i>
                        <span>查看日志</span>
                    </button>
                    <button class="action-item" onclick="testConnection()">
                        <i class="fas fa-network-wired"></i>
                        <span>测试连接</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 配置文件上传弹窗 -->
    <div class="config-upload-overlay" id="configUploadOverlay">
        <div class="config-upload-panel">
            <div class="panel-header">
                <h3>上传配置文件</h3>
                <button class="close-btn" onclick="hideConfigUploadModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="panel-content">
                <!-- 文件拖拽区域 -->
                <div class="config-drop-zone" id="configDropZone">
                    <div class="drop-zone-content">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h4>拖拽配置文件到这里</h4>
                        <p>支持 .conf 格式的 WireGuard 配置文件</p>
                        <span class="drop-hint">或者点击选择文件</span>
                        <input type="file" id="configFileInput" accept=".conf" style="display: none;">
                    </div>
                </div>
                
                <!-- 配置预览区域 -->
                <div class="config-preview" id="configPreview" style="display: none;">
                    <h4>配置预览</h4>
                    <div class="config-options">
                        <div class="option-group">
                            <label for="configInterface">选择接口:</label>
                            <select id="configInterface" class="form-select">
                                <option value="wg0">wg0</option>
                                <option value="wg1">wg1</option>
                                <option value="wg2">wg2</option>
                                <option value="wg3">wg3</option>
                            </select>
                        </div>
                    </div>
                    <div class="preview-content" id="previewContent"></div>
                    <div class="preview-actions">
                        <button class="btn btn-success" onclick="applyConfig()">
                            <i class="fas fa-check"></i>
                            应用配置
                        </button>
                        <button class="btn btn-secondary" onclick="clearConfig()">
                            <i class="fas fa-times"></i>
                            重新选择
                        </button>
                    </div>
                </div>
                
                <!-- 操作按钮 -->
                <div class="upload-actions">
                    <button class="btn btn-primary" onclick="selectConfigFile()">
                        <i class="fas fa-folder-open"></i>
                        选择文件
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 设置面板 -->
    <div class="settings-overlay" id="settingsOverlay">
        <div class="settings-panel">
            <div class="panel-header">
                <h3>系统设置</h3>
                <button class="close-btn" onclick="hideSettings()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="panel-content">
                <div class="settings-section">
                    <h4>显示设置</h4>
                    <div class="setting-item">
                        <label>自动刷新间隔</label>
                        <select id="refreshInterval">
                            <option value="30" selected>30秒</option>
                            <option value="60">1分钟</option>
                            <option value="300">5分钟</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>显示图表</label>
                        <input type="checkbox" id="showCharts" checked>
                    </div>
                </div>
                <div class="settings-section">
                    <h4>通知设置</h4>
                    <div class="setting-item">
                        <label>连接状态变化</label>
                        <input type="checkbox" id="notifyConnection" checked>
                    </div>
                    <div class="setting-item">
                        <label>系统资源警告</label>
                        <input type="checkbox" id="notifyResources" checked>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="/static/js/bootstrap.bundle.min.js"></script>
    <!-- API封装 -->
    <script src="/static/js/api.js"></script>
    <!-- 新的JavaScript -->
    <script src="/static/js/dashboard-new.js"></script>
    

</body>
</html>
